
ALTER PROCEDURE [dbo].[deleteShoppingSession](@shoppingSessionId int,@actionPeformerId int,@referenceId varchar(250)) 
AS
BEGIN

INSERT INTO CartItems_Archive (
      [Archive_Id]
      ,[Quantity]
      ,[Created_At]
      ,[Modified_At]
      ,[Product_Id]
      ,[Sub_total]
      ,[ShoppingSession_Id]
      ,[Action]
      ,[Peformed_At]
      ,[PeformedById]
      ,[Record_Type]
      ,[Reference_Id]
)
SELECT 
        [Id]
      ,[Quantity]
      ,[Created_At]
      ,[Modified_At]
      ,[ProductId]
      ,[Sub_total]
      ,[ShoppingSessionId],
        'DELETE' Actions,
        GETDATE() Peformed_At,
        @actionPeformerId,
        'delete' Record_Type
        ,@referenceId 
 FROM  CartItems WHERE ShoppingSessionId = @shoppingSessionId


 INSERT INTO ShoppingSessions_Archive (
      [Archive_Id]
      ,[Total]
      ,[Created_At]
      ,[Modified_At]
      ,[UserId]
      ,[Action]
      ,[Peformed_At]
      ,[PeformedById]
      ,[Record_Type]
      ,[Reference_Id]
 ) SELECT         
        [Id]
      ,[Total]
      ,[Created_At]
      ,[Modified_At]
      ,[UserId],
    'DELETE' Actions,
    GETDATE() Peformed_At,
    @actionPeformerId,
    'delete' Record_Type
    ,@referenceId  from ShoppingSessions WHERE Id = @shoppingSessionId
END;
